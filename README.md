# scheme2ddl-x (xorader's fork)

scheme2ddl-x is command line util for export oracle schema to set of ddl scripts. Provide a lot of configurations via basic command line options or advanced XML configuartion.

This project is fork of [the main project here](https://github.com/qwazer/scheme2ddl).

The main differences of this fork is:
 - Added option "_isExportDataTable_" in the "_scheme2ddl.config.xml_", which enables exporting of data tables (and LOB data too in separate files)
 - Added many options that allow the exported DDL sql-files to be uploaded (import) back to Oracle DB. All new options (for the possibility of reverse uploading DDL sql-files) see in the _src/main/resources/scheme2ddl-full-schemas-sync.config.xml_ config file (for more information see the differences between _scheme2ddl.config.xml_ and this new config file)
 - Added two new utils:
  - **ddl2scheme.sh** - linux shell script, which automatic upload back to Oracle DB all whole hierarchy of exported DDL sql-files. This script uses (and require) for its work the standart console _sqlplus_ util. 
  - **file2cell.jar** - java util, which allow upload _BLOB_ and _CLOB_ data files to Oracle DB tables cells. This util is used by ddl2scheme.sh for its work.

## ddl2scheme.sh

Type the "_ddl2scheme.sh --help_" for see options and example usage:
```sh
version 'ddl2scheme.sh': 1.1
Util load DDL files into Oracle DB by sqlplus. DDL files takes from <Input directory>.
Util can work in two modes:
 1. 'Single schema loading' - then script runs by single user (non sysdba). This mode
             read the <Input directory> contains other directories as Types and order them
             by CREATE_ORDER_TYPES.
 2. 'Multy schema loading' - then script runs by 'sys as sysdba' superuser. This mode
             read the <Input directory> contains other directories as Schemas list and
             this schemas-directories contains subdirectories as Types. And processing
             this types-subdirectories like 'Single schema loading'.
This util uses the 'sqlplus' util and file2cell jar-file: file2cell-1.1.jar

usage: ./ddl2scheme.sh [-v] [-e] [-S] [-i <Input directory>] [-l <logdir>] <connect URL>
  -v      -- be verbose (use this if it realy need). Not recomended.
  -t      -- check connect and exit.
  -i <input ddls directory> -- directory with DDLs files (generated by scheme2ddl tool).
             Default: 'output'.
  -s <schemaname>           -- force be 'Single schema loading' for Input directory.
             The <Input directory> interprets as dir contains types-directories, even if
             script starting of a superuser.
  -S      -- do not show spinner.
  -e      -- do pause and wait Enter then errors.
  -l <dir>-- directory for logs (default: 'logs_ddl2scheme' in the <Input directory>).
  -R      -- For 'Multy schema loading' (by superuser): DROPs Schemas before creating them.
             For 'Single schema loading': delete all objects for current schema.
  -scheds -- do not stop DBMS SCHEDULER during dbms_jobs loading and start after.
  -stbs   -- do strong (as is) create not existing tablespaces (from the PUBLIC/TABLESPACES
             directory(ies)). Workes for superuser only.
  -ctbs   -- do common (with common option only) create not existing tablespaces (from the
             PUBLIC/TABLESPACES directory(ies)). Workes for superuser only.
             This option creates only PERMANENT tablespaces with common options like:
                 SIZE 512M AUTOEXTEND ... LOGGING...MANAGEMENT...
  -onlydropchemas        -- For 'Multy schema loading':  drop all schemas and exit.
                                    (List schemas takes from the <Input directory>.)
                            For 'Single schema loading': delete all objects for schema
                                    and exit.
  -onlyrecompileinvalids -- recompile all invalid objects and exit.

Examples run:
* ./ddl2scheme.sh -R -i /tmp/some_sql_single_directory SCOTT/TIGER@localhost/SIDNAME
* ./ddl2scheme.sh -ctbs -R -i /tmp/some_sql_multy_directory sys as sysdba/syspasswd@localhost/SIDNAME
```

## file2cell

Type the "_java -jar file2cell-1.1.jar -h_" for see options and example usage...

## by russian (немного подробнее по-русски)

TODO: translate this to english

1. Изменён механизм выгрузки Dependent constrait'ов в отдельные файлы. Для того что бы начинать выгружать Dependent объекты в отдельные файлы теперь нужно использовать _scheme2ddl-full-schemas-sync.config.xml_ конфиг файл в качестве примера. Отличия его от "старого" конфига следующие:
  - Убрана устаревшая опция "processConstraint" из bean-секции "reader".
  - Переведены в состояние "FALSE" следующие опции в bean-секции "transformParams_for_dbms_metadata": CONSTRAINTS_AS_ALTER, CONSTRAINTS, REF_CONSTRAINTS
  - В bean-секции "dependencies" для раздела "TABLE" добавлены значения CONSTRAINT и REF_CONSTRAINT. Во всех разделах bean-секции "dependencies" выключены значения INDEX.
  - В bean-секции "excludes" убрано значение "INDEX", что бы index'ы экспортировались в отдельных объектах в отдельные файлы.
  - Добавлена новая bean-секция "dependenciesInSeparateFiles" в которой перечисляются dependencies из bean-секции "dependencies", которые нужно выгружать как отдельные объекты в отдельные файлы.
1. Добавлена опция "processUserAndPermissions" в bean-секцию "reader" при включении которой начинают выгружаться USER'ы, GRANT'ы и прочие permissions в папку "user(s)".
1. Добавлена опция "isUsedSchemaNamesInFilters" в новую bean-секцию "settingsUserObjectProcessor" при включении которой все фильтры объектов конфига (includesDataTables, excludesDataTables, excludes) будут сравниваться с полными именами объектов с именем схемы в начале (ex: "SCOTT.EMP")
1. Вернулась опция "isMorePrettyFormat" в bean-секцию "ddlFormatter" при включении которой выгрузка объектов будет форматироваться более красиво.
1. Добавлена опция "isExportDataTable" в новую bean-секцию "settingsUserObjectProcessor" при включении которой будут выгружаться данные из таблиц в папку "data_table(s)". Так же для выгрузки данных появились дополнительные настройки:
 - Новые опции "templateDataLob" и "templateDataLobForSysDBA" в bean-секции "fileNameConstructor" позволяющие контролировать именование файлов для LOB данных
 - Новая bean-секция "excludesDataTables" позволяющая фильтровать ненужные к выгрузке данные таблиц
 - Новая bean-секция "includesDataTables" имеющая больший приоритет, чем "excludesDataTables" и заставляющая выгружать объекты попадающие под условия перечисленных фильтров. Так же в этой секции можно ограничивать количество выгружаемых строк для конкретных таблиц, с помощью индивидуальной опций "maxRowsExport" для каждого перечисленного фильтра. А ещё там есть опции "where" и "orderBy". Более подробнее почитайте в комментариях _src/main/resources/scheme2ddl-full-schemas-sync.config.xml_.
1. Добавлены несколько новых полезных фильтров в bean-секцию "excludes" для объектов, которые не выгружаются.

Примеры применения новых опций смотрите в обновлённом _scheme2ddl.config.xml_ примере и в новом _scheme2ddl-full-schemas-sync.config.xml_.

Так же для сборки и полноценной работы нужны библиотеки _ojdbc5.jar, orai18n.jar, xdb6.jar and xmlparserv2_. О том зачем они, как их скачать и установить читайте в комментариях в _pom.xml_.


